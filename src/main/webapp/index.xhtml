<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="WEB-INF/templates/template.xhtml">
	<ui:define name="title">Home page</ui:define>
	<ui:define name="content">

		<h:form id="form">

			<p:growl id="msgs" showDetail="true" />
			<p:growl id="growl" showDetail="true" />

			<p:wizard flowListener="#{flightSearchBean.onFlowProcess}">
				<p:tab id="arrivalDestination" title="Destination">
					<p:panel header="Destination">
						<p:messages />
						<p:panelGrid columns="2" columnClasses="label, value">
							<h:outputText value="Desired Destionation:" />
							<p:autoComplete id="airportAutoComplete"
								value="#{flightSearchBean.arrivalAirport}"
								completeMethod="#{flightSearchBean.completeAirports}"
								var="airport" itemLabel="#{airport.name}" itemValue="#{airport}"
								converter="airportConverter" forceSelection="true">
								<f:facet name="itemtip">
									<h:panelGrid columns="2" cellpadding="5">
										<f:facet name="header">
											<p:outputLabel value="Destionation" />
										</f:facet>
										<h:outputText value="City: " />
										<h:outputText value="#{airport.city}" />
										<h:outputText value="Airport: " />
										<h:outputText value="#{airport.name}" />
									</h:panelGrid>
								</f:facet>

							</p:autoComplete>
						</p:panelGrid>
					</p:panel>
				</p:tab>

				<p:tab id="flights" title="Flights">

					<p:panel
						header="Available flights to #{flightSearchBean.arrivalAirport.name}">

						<p:dataTable id="flightSelectionTable"
							value="#{flightSearchBean.flightsForArrival}" var="flight"
							selection="#{bookingServiceBean.flight}"
							selectionMode="single" rowKey="#{flight.flightNumber}">
							<p:ajax event="rowSelect"
								listener="#{flightSearchBean.onRowSelect}"
								update="#{bookingServiceBean.flight}" />
							<p:ajax event="rowUnselect"
								listener="#{flightSearchBean.onRowUnselect}" update=":form:msgs" />

							<p:column headerText="Flight Number">
								<h:outputText value="#{flight.flightNumber}" />
							</p:column>
							<p:column headerText="Departure">
								<h:outputText value="#{flight.departureDestination.name}" />
							</p:column>
							<p:column headerText="Departure Time"
								sortBy="#{flight.departureTime}">
								<h:outputText value="#{flight.departureTime}">
									<f:convertDateTime type="both"
										timeZone="#{loginServiceBean.timeZone}" />
								</h:outputText>
							</p:column>
							<p:column headerText="Airline Company"
								sortBy="#{flight.airline.name}">
								<h:outputText value="#{flight.airline.name}" />
							</p:column>
							<p:column headerText="Ticket Price" sortBy="#{flight.basePrice}">
								<h:outputText value="€ #{flight.basePrice}">
									<f:convertNumber type="currency" maxFractionDigits="2" />
								</h:outputText>
							</p:column>
						</p:dataTable>
					</p:panel>
				</p:tab>

				<p:tab id="ticketChoice" title="Tickets">
					<h:panelGrid columns="2" cellPadding="5">

						<h:outputText for="flightClass" value="Flight class:" />
						<p:selectOneRadio id="flightClass"
							value="#{bookingServiceBean.selectedTravelClass}">
							<f:selectItem itemLabel="Economy" itemValue="ECONOMY" />
							<f:selectItem itemLabel="Business" itemValue="BUSINESS" />
							<f:selectItem itemLabel="First Class" itemValue="FIRST_CLASS" />
							<p:ajax update="priceOneTicket"
								listener="#{flightSearchBean.changePriceOfOneTicket}" />
							<p:ajax update="totalPrice"
								listener="#{bookingServiceBean.calculateTotalPrice(flightSearchBean.priceOfTicket)}"
								process="@this" />
						</p:selectOneRadio>

						<h:outputText for="numberOfTickets" value="Number of tickets:" />
						<p:outputPanel>
							<p:spinner id="numberOfTickets"
								value="#{bookingServiceBean.nSeatsWanted}" min="0" max="#{bookingServiceBean.maximumSeatsForClass()}">
								<p:ajax update="totalPrice"
									listener="#{bookingServiceBean.calculateTotalPrice(flightSearchBean.priceOfTicket)}"
									process="@this" />
							</p:spinner>
						</p:outputPanel>

						<h:outputText for="priceOneTicket" value="Price for one ticket:" />
						<h:outputText id="priceOneTicket"
							value="€#{flightSearchBean.priceOfTicket}">
						</h:outputText>

						<h:outputText for="totalPrice" value="Total price:" />
						<h:outputText id="totalPrice"
							value="€ #{bookingServiceBean.priceOfBooking}">
							<f:convertNumber type="currency" maxFractionDigits="2" />
						</h:outputText>

					</h:panelGrid>
				</p:tab>

				<p:tab id="flightDetails" title="Flight Details">

					<p:panel header="Details of your selected flight">
						<p:panelGrid columns="2" cellPading="5">

							<h:outputText for="detailTabflightNumber" value="Flight number:" />
							<h:outputText id="detailTabflightNumber"
								value="#{bookingServiceBean.flight.flightNumber}" />

							<h:outputText for="detailTabdeparture" value="Departure:" />
							<h:outputText id="detailTabdeparture"
								value="#{bookingServiceBean.flight.departureDestination.name}" />

							<h:outputText for="detailTabarrival" value="Arrival:" />
							<h:outputText id="detailTabarrival"
								value="#{bookingServiceBean.flight.arrivalDestination.name}" />

							<h:outputText for="detailTabdepartureTime"
								value="Departure Time:" />
							<h:outputText id="detailTabdepartureTime"
								value="#{bookingServiceBean.flight.departureTime}">
								<f:convertDateTime type="both"
									timeZone="#{loginServiceBean.timeZone}" />
							</h:outputText>

							<h:outputText for="detailTabairline" value="Airline: " />
							<h:outputText id="detailTabairline"
								value="#{bookingServiceBean.flight.airline.name}" />

							<h:outputText for="detailTabtravelingClass"
								value="Traveling class:" />
							<h:outputText id="detailTabtravelingClass"
								value="#{bookingServiceBean.selectedTravelClass}" />

							<h:outputText for="detailTabnumberOfTickets"
								value="Number of Tickets:" />
							<h:outputText id="detailTabnumberOfTickets"
								value="#{bookingServiceBean.nSeatsWanted}" />

							<h:outputText for="detailTabpriceOneTicket"
								value="Price of One Ticket:" />
							<h:outputText id="detailTabpriceOneTicket"
								value="€#{flightSearchBean.priceOfTicket}">
								<f:convertNumber type="currency" maxFractionDigits="2" />
							</h:outputText>

							<h:outputText for="detailTabtotalPrice"
								value="Total price for flight:" />
							<h:outputText id="detailTabtotalPrice"
								value="€#{bookingServiceBean.priceOfBooking}">
								<f:convertNumber type="currency" maxFractionDigits="2" />
							</h:outputText>

						</p:panelGrid>

						<p:commandButton value="Book now" ajax="false">
							<p:confirm header="Are you registered?" />
						</p:commandButton>
						
						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" message="Did you register for this website in the past?">
							<p:button value="Yes" outcome="login.xhtml?faces-redirect=true"/>
							<p:button value="No" outcome="register.xhtml?faces-redirect=true"/>
						</p:confirmDialog>


					</p:panel>
				</p:tab>
			</p:wizard>
		</h:form>
	</ui:define>
</ui:composition>

</html>
